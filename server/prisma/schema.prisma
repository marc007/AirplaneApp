generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model Manufacturer {
  id        Int             @id @default(autoincrement())
  name      String          @unique @db.NVarChar(255)
  createdAt DateTime        @default(now()) @db.DateTime2
  updatedAt DateTime        @updatedAt @db.DateTime2
  models    AircraftModel[]
}

model AircraftModel {
  id                 Int             @id @default(autoincrement())
  code               String          @unique @db.NVarChar(10)
  manufacturerId     Int
  manufacturer       Manufacturer    @relation(fields: [manufacturerId], references: [id])
  modelName          String          @db.NVarChar(255)
  typeAircraft       String?         @db.NVarChar(50)
  typeEngine         String?         @db.NVarChar(50)
  category           String?         @db.NVarChar(25)
  buildCertification String?         @db.NVarChar(50)
  numberOfEngines    Int?
  numberOfSeats      Int?
  weightClass        String?         @db.NVarChar(25)
  cruiseSpeed        Int?
  createdAt          DateTime        @default(now()) @db.DateTime2
  updatedAt          DateTime        @updatedAt @db.DateTime2
  aircraft           Aircraft[]

  @@index([manufacturerId])
}

model Engine {
  id           Int        @id @default(autoincrement())
  code         String     @unique @db.NVarChar(20)
  manufacturer String?    @db.NVarChar(255)
  model        String?    @db.NVarChar(255)
  type         String?    @db.NVarChar(50)
  horsepower   Int?
  thrust       Int?
  createdAt    DateTime   @default(now()) @db.DateTime2
  updatedAt    DateTime   @updatedAt @db.DateTime2
  aircraft     Aircraft[]

  @@index([manufacturer])
}

model Owner {
  id           Int             @id @default(autoincrement())
  externalKey  String          @unique @db.NVarChar(20)
  name         String          @db.NVarChar(255)
  addressLine1 String?         @db.NVarChar(255)
  addressLine2 String?         @db.NVarChar(255)
  city         String?         @db.NVarChar(128)
  state        String?         @db.NVarChar(50)
  postalCode   String?         @db.NVarChar(20)
  country      String?         @db.NVarChar(50)
  region       String?         @db.NVarChar(255)
  county       String?         @db.NVarChar(255)
  createdAt    DateTime        @default(now()) @db.DateTime2
  updatedAt    DateTime        @updatedAt @db.DateTime2
  aircraft     AircraftOwner[]

  @@index([name])
}

model AircraftOwner {
  aircraftId     Int
  ownerId        Int
  ownershipType  String?   @db.NVarChar(50)
  lastActionDate DateTime? @db.DateTime2
  createdAt      DateTime  @default(now()) @db.DateTime2
  updatedAt      DateTime  @updatedAt @db.DateTime2

  aircraft Aircraft @relation(fields: [aircraftId], references: [id])
  owner    Owner    @relation(fields: [ownerId], references: [id])

  @@id([aircraftId, ownerId])
  @@index([ownerId])
}

model DatasetIngestion {
  id                 Int        @id @default(autoincrement())
  sourceUrl          String     @db.NVarChar(2048)
  downloadedAt       DateTime   @db.DateTime2
  dataVersion        String?    @db.NVarChar(100)
  status             String     @default("PENDING") @db.NVarChar(20)
  trigger            String     @default("MANUAL") @db.NVarChar(20)
  startedAt          DateTime   @default(now()) @db.DateTime2
  completedAt        DateTime?  @db.DateTime2
  failedAt           DateTime?  @db.DateTime2
  errorMessage       String?    @db.NVarChar(MAX)
  totalManufacturers Int?
  totalModels        Int?
  totalEngines       Int?
  totalAircraft      Int?
  totalOwners        Int?
  totalOwnerLinks    Int?
  createdAt          DateTime   @default(now()) @db.DateTime2
  updatedAt          DateTime   @updatedAt @db.DateTime2
  aircraft           Aircraft[]

  @@index([startedAt])
}

model Aircraft {
  id                     Int               @id @default(autoincrement())
  tailNumber             String            @unique @db.NVarChar(10)
  serialNumber           String?           @db.NVarChar(100)
  modelId                Int?
  model                  AircraftModel?    @relation(fields: [modelId], references: [id])
  engineId               Int?
  engine                 Engine?           @relation(fields: [engineId], references: [id])
  engineCode             String?           @db.NVarChar(20)
  yearManufactured       Int?
  registrantType         String?           @db.NVarChar(50)
  certification          String?           @db.NVarChar(100)
  aircraftType           String?           @db.NVarChar(50)
  engineType             String?           @db.NVarChar(50)
  statusCode             String?           @db.NVarChar(20)
  modeSCode              String?           @db.NVarChar(20)
  modeSCodeHex           String?           @db.NVarChar(20)
  fractionalOwnership    Boolean?          @db.Bit
  airworthinessClass     String?           @db.NVarChar(100)
  expirationDate         DateTime?         @db.DateTime2
  lastActivityDate       DateTime?         @db.DateTime2
  certificationIssueDate DateTime?         @db.DateTime2
  kitManufacturer        String?           @db.NVarChar(255)
  kitModel               String?           @db.NVarChar(255)
  statusCodeChangeDate   DateTime?         @db.DateTime2
  datasetIngestionId     Int?
  datasetIngestion       DatasetIngestion? @relation(fields: [datasetIngestionId], references: [id])
  createdAt              DateTime          @default(now()) @db.DateTime2
  updatedAt              DateTime          @updatedAt @db.DateTime2
  owners                 AircraftOwner[]

  @@index([modelId])
  @@index([engineId])
  @@index([statusCode])
  @@index([modeSCode])
  @@index([modeSCodeHex])
  @@index([registrantType])
  @@index([datasetIngestionId])
}

model AircraftSearchLog {
  id          Int      @id @default(autoincrement())
  tailNumber  String   @db.NVarChar(10)
  searchQuery String   @db.NVarChar(50)
  createdAt   DateTime @default(now()) @db.DateTime2
}
